<!DOCTYPE html>
<html lang="en" data-theme="corporate">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriftMgr v3.0 - Terraform State Intelligence Platform</title>
    
    <!-- Tailwind CSS and DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Alpine.js for reactivity -->
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    
    <style>
        /* Clean, professional styling */
        :root {
            --primary-color: #7B42BC; /* Terraform purple */
            --secondary-color: #ff9900; /* AWS orange */
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
        }
        
        .terraform-gradient {
            background: linear-gradient(135deg, #7B42BC 0%, #5E2CA5 100%);
        }
        
        .tab-active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        /* WebSocket status indicator */
        .ws-connected {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body x-data="driftMgrV3App()" x-init="init()" class="min-h-screen bg-gray-50">
    
    <!-- Top Navigation Bar -->
    <nav class="navbar bg-white shadow-sm border-b">
        <div class="navbar-start">
            <div class="flex items-center gap-3">
                <div class="text-2xl font-mono font-bold text-primary">DriftMgr</div>
                <div class="badge badge-primary">v3.0</div>
                <div x-show="wsConnected" class="badge badge-success gap-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full ws-connected"></div>
                    <span>Connected</span>
                </div>
            </div>
        </div>
        
        <div class="navbar-center">
            <!-- Quick Actions Bar -->
            <div class="flex gap-2">
                <button @click="discoverBackends()" class="btn btn-sm btn-primary">
                    <i class="fas fa-search"></i> Discover Backends
                </button>
                <button @click="runDriftDetection()" class="btn btn-sm btn-warning">
                    <i class="fas fa-sync"></i> Detect Drift
                </button>
                <button @click="openImportWizard()" class="btn btn-sm btn-success">
                    <i class="fas fa-file-import"></i> Import Resources
                </button>
            </div>
        </div>
        
        <div class="navbar-end gap-2">
            <!-- Environment Selector -->
            <select x-model="selectedEnvironment" class="select select-sm select-bordered">
                <option value="development">Development</option>
                <option value="staging">Staging</option>
                <option value="production">Production</option>
            </select>
            
            <!-- Notifications -->
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-circle">
                    <div class="indicator">
                        <i class="fas fa-bell"></i>
                        <span x-show="notifications.length > 0" class="badge badge-xs badge-primary indicator-item" x-text="notifications.length"></span>
                    </div>
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-80 max-h-96 overflow-y-auto">
                    <template x-for="notification in notifications" :key="notification.id">
                        <li>
                            <div class="alert" :class="'alert-' + notification.type">
                                <div>
                                    <span x-text="notification.message"></span>
                                    <div class="text-xs opacity-60" x-text="notification.timestamp"></div>
                                </div>
                            </div>
                        </li>
                    </template>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Main Navigation Tabs (v3.0 Architecture Aligned) -->
    <div class="tabs tabs-boxed bg-white shadow-sm p-2">
        <a @click="currentView = 'backends'" :class="currentView === 'backends' ? 'tab-active' : ''" class="tab">
            <i class="fas fa-database mr-2"></i> Backend Discovery
        </a>
        <a @click="currentView = 'states'" :class="currentView === 'states' ? 'tab-active' : ''" class="tab">
            <i class="fas fa-file-code mr-2"></i> State Management
        </a>
        <a @click="currentView = 'drift'" :class="currentView === 'drift' ? 'tab-active' : ''" class="tab">
            <i class="fas fa-exchange-alt mr-2"></i> Drift Detection
        </a>
        <a @click="currentView = 'resources'" :class="currentView === 'resources' ? 'tab-active' : ''" class="tab">
            <i class="fas fa-cube mr-2"></i> Resources
        </a>
    </div>
    
    <!-- Main Content Area -->
    <div class="container mx-auto p-4">
        
        <!-- Backend Discovery View (New in v3.0) -->
        <div x-show="currentView === 'backends'" class="space-y-4">
            <div class="card bg-white shadow-lg">
                <div class="card-body">
                    <h2 class="card-title">
                        <i class="fas fa-database"></i> Remote Backend Discovery
                    </h2>
                    
                    <!-- Backend Types -->
                    <div class="grid grid-cols-4 gap-4 mt-4">
                        <div class="stat bg-base-100 rounded-lg shadow">
                            <div class="stat-figure text-primary">
                                <i class="fab fa-aws text-3xl"></i>
                            </div>
                            <div class="stat-title">S3 Backends</div>
                            <div class="stat-value" x-text="backends.s3.count">0</div>
                            <div class="stat-desc">
                                <span x-text="backends.s3.states"></span> state files
                            </div>
                        </div>
                        
                        <div class="stat bg-base-100 rounded-lg shadow">
                            <div class="stat-figure text-info">
                                <i class="fab fa-microsoft text-3xl"></i>
                            </div>
                            <div class="stat-title">Azure Storage</div>
                            <div class="stat-value" x-text="backends.azure.count">0</div>
                            <div class="stat-desc">
                                <span x-text="backends.azure.states"></span> state files
                            </div>
                        </div>
                        
                        <div class="stat bg-base-100 rounded-lg shadow">
                            <div class="stat-figure text-success">
                                <i class="fab fa-google text-3xl"></i>
                            </div>
                            <div class="stat-title">GCS Backends</div>
                            <div class="stat-value" x-text="backends.gcs.count">0</div>
                            <div class="stat-desc">
                                <span x-text="backends.gcs.states"></span> state files
                            </div>
                        </div>
                        
                        <div class="stat bg-base-100 rounded-lg shadow">
                            <div class="stat-figure text-warning">
                                <i class="fas fa-folder text-3xl"></i>
                            </div>
                            <div class="stat-title">Local</div>
                            <div class="stat-value" x-text="backends.local.count">0</div>
                            <div class="stat-desc">
                                <span x-text="backends.local.states"></span> state files
                            </div>
                        </div>
                    </div>
                    
                    <!-- Discovery Actions -->
                    <div class="flex gap-2 mt-4">
                        <button @click="scanForBackends()" class="btn btn-primary">
                            <i class="fas fa-radar"></i> Scan for Backends
                        </button>
                        <button @click="configureBackend()" class="btn btn-secondary">
                            <i class="fas fa-cog"></i> Configure Backend
                        </button>
                    </div>
                    
                    <!-- Backend List -->
                    <div class="overflow-x-auto mt-4">
                        <table class="table table-zebra w-full">
                            <thead>
                                <tr>
                                    <th>Backend Type</th>
                                    <th>Location</th>
                                    <th>State Files</th>
                                    <th>Last Accessed</th>
                                    <th>Lock Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="backend in backendsList" :key="backend.id">
                                    <tr>
                                        <td>
                                            <span class="badge" :class="getBackendBadgeClass(backend.type)" x-text="backend.type"></span>
                                        </td>
                                        <td x-text="backend.location"></td>
                                        <td x-text="backend.stateCount"></td>
                                        <td x-text="backend.lastAccessed"></td>
                                        <td>
                                            <span x-show="!backend.locked" class="badge badge-success">Unlocked</span>
                                            <span x-show="backend.locked" class="badge badge-error">Locked</span>
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                <button @click="exploreBackend(backend)" class="btn btn-xs btn-info">
                                                    <i class="fas fa-folder-open"></i>
                                                </button>
                                                <button @click="pullState(backend)" class="btn btn-xs btn-success">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                                <button @click="pushState(backend)" class="btn btn-xs btn-warning">
                                                    <i class="fas fa-upload"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- State Management View (Enhanced for v3.0) -->
        <div x-show="currentView === 'states'" class="space-y-4">
            <div class="card bg-white shadow-lg">
                <div class="card-body">
                    <h2 class="card-title">
                        <i class="fas fa-file-code"></i> Terraform State Management
                    </h2>
                    
                    <!-- State Operations -->
                    <div class="tabs tabs-boxed">
                        <a @click="stateTab = 'browser'" :class="stateTab === 'browser' ? 'tab-active' : ''" class="tab">Browse States</a>
                    </div>
                    
                    <!-- State Browser Tab -->
                    <div x-show="stateTab === 'browser'" class="mt-4">
                        <div class="grid grid-cols-3 gap-4">
                            <!-- State File List -->
                            <div class="col-span-1 border-r pr-4">
                                <h3 class="font-bold mb-2">State Files</h3>
                                <div class="space-y-2">
                                    <template x-for="state in stateFiles" :key="state.path">
                                        <div @click="selectState(state)" class="cursor-pointer p-2 hover:bg-base-200 rounded" :class="selectedState?.path === state.path ? 'bg-primary/10' : ''">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <div class="font-semibold" x-text="state.name"></div>
                                                    <div class="text-xs opacity-60" x-text="state.backend"></div>
                                                </div>
                                                <span class="badge badge-sm" x-text="state.resourceCount + ' resources'"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- State Details -->
                            <div class="col-span-2 pl-4">
                                <div x-show="selectedState">
                                    <h3 class="font-bold mb-2">State Details</h3>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span>Version:</span>
                                            <span class="font-mono" x-text="selectedState?.version"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Serial:</span>
                                            <span class="font-mono" x-text="selectedState?.serial"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Lineage:</span>
                                            <span class="font-mono text-xs" x-text="selectedState?.lineage"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Terraform Version:</span>
                                            <span class="font-mono" x-text="selectedState?.terraformVersion"></span>
                                        </div>
                                        
                                        <!-- Resource List -->
                                        <div class="mt-4">
                                            <h4 class="font-semibold mb-2">Resources</h4>
                                            <div class="max-h-64 overflow-y-auto">
                                                <template x-for="resource in selectedState?.resources" :key="resource.address">
                                                    <div class="flex items-center justify-between p-2 hover:bg-base-200 rounded">
                                                        <div>
                                                            <div class="font-mono text-sm" x-text="resource.address"></div>
                                                            <div class="text-xs opacity-60" x-text="resource.type"></div>
                                                        </div>
                                                        <div class="badge badge-sm" x-text="resource.provider"></div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <!-- Drift Detection View -->
        <div x-show="currentView === 'drift'" class="space-y-4">
            <div class="card bg-white shadow-lg">
                <div class="card-body">
                    <h2 class="card-title">
                        <i class="fas fa-exchange-alt"></i> Drift Detection
                    </h2>
                    
                    <!-- Drift Detection Actions -->
                    <div class="flex gap-2 mt-4">
                        <button @click="runDriftDetection()" class="btn btn-primary">
                            <i class="fas fa-sync"></i> Detect Drift
                        </button>
                        <button @click="scheduleDriftDetection()" class="btn btn-secondary">
                            <i class="fas fa-clock"></i> Schedule Detection
                        </button>
                    </div>

                    <!-- Drift Results -->
                    <div class="mt-4">
                        <h3 class="font-bold mb-2">Recent Drift Detection Results</h3>
                        <div class="overflow-x-auto">
                            <table class="table table-zebra w-full">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Provider</th>
                                        <th>Drift Count</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="result in driftResults" :key="result.id">
                                        <tr>
                                            <td x-text="result.timestamp"></td>
                                            <td x-text="result.provider"></td>
                                            <td>
                                                <span class="badge badge-warning" x-text="result.drift_count"></span>
                                            </td>
                                            <td>
                                                <span class="badge badge-success" x-text="result.status"></span>
                                            </td>
                                            <td>
                                                <button @click="viewDriftDetails(result)" class="btn btn-xs btn-info">
                                                    <i class="fas fa-eye"></i> View Details
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources View -->
        <div x-show="currentView === 'resources'" class="space-y-4">
            <div class="card bg-white shadow-lg">
                <div class="card-body">
                    <h2 class="card-title">
                        <i class="fas fa-cube"></i> Cloud Resources
                    </h2>

                    <!-- Provider Filter -->
                    <div class="flex gap-2 mt-4">
                        <select x-model="selectedProvider" @change="loadResources()" class="select select-bordered">
                            <option value="aws">AWS</option>
                            <option value="azure">Azure</option>
                            <option value="gcp">GCP</option>
                        </select>
                        <button @click="loadResources()" class="btn btn-primary">
                            <i class="fas fa-refresh"></i> Refresh
                        </button>
                    </div>

                    <!-- Resources List -->
                    <div class="mt-4">
                        <h3 class="font-bold mb-2">Resources (<span x-text="selectedProvider"></span>)</h3>
                        <div class="overflow-x-auto">
                            <table class="table table-zebra w-full">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Region</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="resource in resources" :key="resource.id">
                                        <tr>
                                            <td class="font-mono text-sm" x-text="resource.name"></td>
                                            <td>
                                                <span class="badge badge-outline" x-text="resource.type"></span>
                                            </td>
                                            <td x-text="resource.region"></td>
                                            <td>
                                                <span class="badge badge-success" x-text="resource.status"></span>
                                            </td>
                                            <td class="text-sm" x-text="resource.created"></td>
                                            <td>
                                                <button @click="viewResourceDetails(resource)" class="btn btn-xs btn-info">
                                                    <i class="fas fa-eye"></i> Details
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        
        
        
    </div>
    
    <!-- Progress Modal for Long Operations -->
    <div x-show="showProgress" class="modal modal-open">
        <div class="modal-box">
            <h3 class="font-bold text-lg" x-text="progressTitle">Operation in Progress</h3>
            <p class="py-4" x-text="progressMessage">Processing...</p>
            <progress class="progress progress-primary w-full" :value="progressValue" max="100"></progress>
            <div class="modal-action">
                <button @click="cancelOperation()" class="btn btn-error">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Load the v3.0 aligned JavaScript -->
    <script src="js/ui-enhancements.js"></script>
    <script src="js/app.js"></script>
</body>
</html>